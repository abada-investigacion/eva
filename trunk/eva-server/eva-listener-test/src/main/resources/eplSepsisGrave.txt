

expression boolean js:checkPatient(c, oru) [

    importClass (java.lang.System);     
                  
    checkPatient(c, oru);
    function checkPatient(c, oru) {
     
      var pid3 = oru.getPATIENT_RESULT().getPATIENT().getPID().getPatientIdentifierList();
        
      for(var i=0 ; i<pid3.length ; i++){
        
        var code = pid3[i].getCx5_IdentifierTypeCode().getValue();
        var id = pid3[i].getCx1_IDNumber().getValue();
        
        if( code.equals("PI") && id.equals(c.getNhc())){
            return true;
        }
      }
      
      return false;
    }
]

select s, oru from pattern [ (every-distinct(s.getUUID()) s=SEPSIS_SIMPLE -> every oru=ORU_R01(checkPatient(s,oru))) or (every-distinct(oru.getMSH().getMsh10_MessageControlID().getValue()) oru=ORU_R01 -> every s=SEPSIS_SIMPLE(checkPatient(s,oru)))]

