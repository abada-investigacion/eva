

expression boolean js:checkPatient(c, oru) [

    importClass (java.lang.System);     
                
    checkPatient(c, oru);
    function checkPatient(c, oru) {
        var pid3 = oru.getPATIENT_RESULT().getPATIENT().getPID().getPatientIdentifierList();
        
        for(var i=0 ; i<pid3.length ; i++){
        
            var code = pid3[i].getCx5_IdentifierTypeCode().getValue();
            var id = pid3[i].getCx1_IDNumber().getValue();
        
            if( code.equals("PI") && id.equals(c.getNhc())){
                System.out.println("checkpatient success");  
                return true;
            }
        }
        System.out.println("checkpatient failed"); 
        return false;
    }
]

expression boolean js:checkHemocultivo(oru) [

    importClass (java.lang.System);     
                  
    checkHemocultivo(oru);
    function checkHemocultivo(oru) {
          
        var order = oru.getPATIENT_RESULT().getORDER_OBSERVATIONAll();

        for(var i=0 ; i<order.size() ; i++) {
            
            var obs = order.get(i).getOBSERVATIONAll();
               
            for(var z=0; z<obs.size(); z++){
                             
                var code = obs.get(z).getOBX().getObx3_ObservationIdentifier().getCe1_Identifier().getValue();
                
                System.out.println("********* "+code+" *********");
                
                if(code!=null && code.equals("41852-5")){
                   System.out.println("checkhemocultivo success");
                    return true;
                }
               
            }
          
        }
      System.out.println("checkhemocultivo failed");
        return false;
    }
]


select ss, oru from pattern [ (every-distinct(ss.getUUID()) ss=SEPSIS_SYNDROME -> every oru=ORU_R01(checkPatient(ss,oru),checkHemocultivo(oru)))or(every-distinct(oru.getMSH().getMsh10_MessageControlID().getValue()) oru=ORU_R01 -> every ss=SEPSIS_SYNDROME(checkPatient(ss,oru),checkHemocultivo(oru)))]

